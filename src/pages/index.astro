---
import "../css/base.css";
import "../css/topbar.css";
import "../css/buttons.css";
import "../css/modal.css";
export const prerender = true;
const clientScript = import.meta.env.DEV
  ? "/src/scripts/index-client.ts"
  : "/scripts/index-client.js";
---

<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <link
      rel="icon"
      type="image/svg+xml"
      href="/StreamlinePlumpColorWebFlat.svg"
    />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>å‹é“¾å›¾è°±</title>
  </head>
  <body>
    <div class="topbar">
      <div class="title" style="font-weight:600; padding-left:6px;">
        <span>å‹é“¾å›¾è°±</span>
        <a
          class="github-link"
          href="https://github.com/xingwangzhe/FriendLinks"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Open GitHub repository"
        >
          <svg
            width="18"
            height="18"
            viewBox="0 0 16 16"
            fill="currentColor"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.19 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"
            ></path>
          </svg>
        </a>
      </div>
      <div class="search">
        <input
          id="graph-search"
          type="text"
          placeholder="æœç´¢ï¼šç«™ç‚¹åæˆ–åŸŸåï¼ˆç¤ºä¾‹: example.comï¼‰"
          autocomplete="off"
        />
        <button id="graph-search-clear" class="search-clear" aria-label="æ¸…ç©ºæœç´¢" title="æ¸…ç©ºæœç´¢">âœ–</button>
        <div id="graph-search-results" class="results" role="listbox"></div>
      </div>
    </div>
    <div id="main"></div>
    <div class="top-buttons">
      <button id="theme-toggle" class="top-button" aria-label="åˆ‡æ¢ä¸»é¢˜"
        >åˆ‡æ¢ä¸»é¢˜</button
      >
      <button id="about-toggle" class="top-button" aria-label="å…³äºé¡¹ç›®"
        >å…³äº</button
      >
      <button id="stats-toggle" class="top-button" aria-label="æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯"
        >ğŸ“Šå‹é“¾ç»Ÿè®¡</button
      >
    </div>

    <!-- ç»Ÿè®¡å¼¹çª— -->
    <div id="stats-modal" role="dialog" aria-modal="true">
      <div class="modal-content">
        <div class="modal-header">
          <h2>ğŸ“Š å‹é“¾ç»Ÿè®¡</h2>
          <button class="close-btn" aria-label="å…³é—­">&times;</button>
        </div>
        <div id="stats-content">
          <div class="loading">åŠ è½½ä¸­...</div>
        </div>
      </div>
    </div>
    <!-- å…³äºå¼¹çª— -->
    <div id="about-modal" role="dialog" aria-modal="true">
      <div class="modal-content">
        <div class="modal-header">
          <h2>å…³äº FriendLinks</h2>
          <button class="close-btn" aria-label="å…³é—­">&times;</button>
        </div>
        <div class="about-content">
          <h3>VIBE CODE â€” åšå®¢å‹é“¾ç½‘</h3>
          <p><strong>æ³•å¾‹åˆè§„è¯´æ˜ï¼š</strong>ç½‘ç«™æ‰€æœ‰è€…å’ŒæŠ•ç¨¿è€…å¿…é¡»ç¡®ä¿å…¶å‘å¸ƒå†…å®¹åŠç½‘ç«™è¿è¥éµå®ˆä¸­åäººæ°‘å…±å’Œå›½ä»¥åŠé€‚ç”¨æƒ…å†µä¸‹çš„ç¾åˆ©åšåˆä¼—å›½æ³•å¾‹æ³•è§„ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºç‰ˆæƒã€éšç§ã€ç½‘ç»œå®‰å…¨ä¸ä¿¡æ¯å†…å®¹æ–¹é¢çš„æ³•å¾‹ï¼‰ã€‚</p>
          <p><strong>è¯·ç¡®ä¿ï¼š</strong>ä½ çš„ç«™ç‚¹ä½¿ç”¨ <code>https</code> å¹¶å¯ä»¥åœ¨å¤§é™†è®¿é—®ã€‚</p>
          <h4>æ·»åŠ ä½ çš„åšå®¢</h4>
          <p>åœ¨ <code>links/&#123;yoursite&#125;.yml</code> ä¸­å¡«å†™ä½ çš„ç«™ç‚¹ä¿¡æ¯ï¼Œç¤ºä¾‹æ ¼å¼å¦‚ä¸‹ï¼š</p>
          <pre><code class="yaml">site:
  name: æˆ‘çš„åšå®¢
  description: åˆ†äº«ç¼–ç¨‹å’ŒæŠ€æœ¯ç›¸å…³çš„æ–‡ç« 
  url: https://example.com
  friends:
    - name: ç¼–ç¨‹å°ç«™
      url: https://codehub.example.com
    - name: æŠ€æœ¯å‰æ²¿
      url: https://techfrontier.example.com</code></pre>
          <h4>URL èšç„¦æŸ¥è¯¢ï¼ˆè‡ªåŠ¨é«˜äº®ï¼‰</h4>
          <p>ä½ å¯ä»¥é€šè¿‡åœ¨é¡µé¢åœ°å€ä¸­æ·»åŠ æŸ¥è¯¢å‚æ•°æ¥è‡ªåŠ¨èšç„¦å¹¶é«˜äº®æŒ‡å®šç«™ç‚¹èŠ‚ç‚¹ã€‚æ”¯æŒä»¥ä¸‹æ ¼å¼ï¼š</p>
          <ul>
            <li>ä½¿ç”¨åŸŸåï¼ˆhostnameï¼‰åŒ¹é…ï¼š<code>?local=example.com</code></li>
            <li>ä½¿ç”¨å®Œæ•´ URLï¼š<code>?local=https://example.com</code> æˆ– <code>?local=http://example.com/path</code></li>
          </ul>
          <p>åŒ¹é…è§„åˆ™ï¼ˆå¼±åŒ¹é…ï¼Œå¤§å°å†™ä¸æ•æ„Ÿï¼‰ï¼š</p>
          <ul>
            <li>ä¼˜å…ˆåŒ¹é…èŠ‚ç‚¹çš„ <code>url</code> çš„ hostnameï¼›</li>
            <li>å¦‚æœæœªè§£æå‡º hostnameï¼Œåˆ™å°è¯•åœ¨èŠ‚ç‚¹çš„ <code>url</code> ä¸­è¿›è¡ŒåŒ…å«åŒ¹é…ï¼›</li>
            <li>æˆåŠŸåŒ¹é…åé¡µé¢ä¼šå°è¯•æŠŠç›®æ ‡èŠ‚ç‚¹ç§»åŠ¨åˆ°å±å¹•ä¸­å¿ƒå¹¶è¿›è¡ŒçŸ­æ—¶é«˜äº®ï¼ˆè§†è§‰æç¤ºï¼‰ã€‚</li>
          </ul>
          <h4>è„šæœ¬ APIï¼ˆä¾›ç¨‹åºåŒ–ä½¿ç”¨ï¼‰</h4>
          <ul>
            <li><code>window.__graphApi.find(query)</code>ï¼šæŒ‰åç§°/åŸŸå/URL æœç´¢ï¼Œè¿”å›åŒ¹é…é¡¹æ•°ç»„ï¼ˆå« <code>name</code> ä¸ <code>url</code>ï¼‰ã€‚</li>
            <li><code>window.__graphApi.focusByDomain(urlOrHost)</code>ï¼šæ ¹æ®åŸŸåæˆ–å®Œæ•´ URL æŸ¥æ‰¾å¹¶èšç„¦/é«˜äº®å¯¹åº”èŠ‚ç‚¹ã€‚</li>
          </ul>
          <p>ç¤ºä¾‹ï¼š<code>https://links.needhelp.icu/?local=example.com</code> â€” é¡µé¢åŠ è½½åä¼šè‡ªåŠ¨èšç„¦å¹¶é«˜äº®ä¸ <code>example.com</code> åŒ¹é…çš„èŠ‚ç‚¹ã€‚</p>
          <h4>å¦‚ä½•è´¡çŒ®</h4>
          <ol>
            <li>Fork æœ¬ä»“åº“å¹¶åˆ›å»ºæ–°åˆ†æ”¯ç”¨äºæ”¹åŠ¨ã€‚</li>
            <li>åœ¨ <code>links/</code> ä¸‹æ·»åŠ æˆ–æ›´æ–°ä½ çš„ <code>blog.yml</code> æ–‡ä»¶ï¼ˆè§ <code>AGENTS.md</code> è¯´æ˜ï¼‰ã€‚</li>
            <li>æäº¤æ”¹åŠ¨å¹¶æ PRï¼Œæˆ‘ä»¬ä¼šå®¡æŸ¥å¹¶åˆå¹¶å…¥ä¸»å¹²ã€‚</li>
          </ol>
          <div style="margin-top: 12px; display:flex; gap:8px; flex-wrap:wrap;">
            <a href="https://github.com/xingwangzhe/FriendLinks" target="_blank" rel="noopener" class="modal-link">æŸ¥çœ‹ä»“åº“</a>
          </div>
        </div>
      </div>
    </div>
    <style>
      /* é¡¶éƒ¨æŒ‰é’®é€šç”¨æ ·å¼ */
      .top-button {
        padding: 6px 10px;
        border: 1px solid var(--border);
        border-radius: 6px;
        background: var(--card-bg);
        color: var(--text-color);
        cursor: pointer;
        pointer-events: auto;
        font-size: 14px;
        white-space: nowrap;
      }
      .top-button:focus {
        outline: 2px solid
          color-mix(in srgb, var(--text-color) 20%, transparent);
      }

      /* æŒ‰é’®å®¹å™¨ */
      .top-buttons {
        position: fixed;
        top: 12px;
        right: 12px;
        z-index: 60; /* é«˜äº .topbar (20) å’Œç§»åŠ¨ç«¯çš„ #theme-toggle (40) */
        display: flex;
        gap: 8px;
        pointer-events: auto;
      }

      /* è¦†ç›–å¯èƒ½å­˜åœ¨çš„ id é€‰æ‹©å™¨å®šä½ï¼ˆæ¥è‡ª topbar.cssï¼‰ï¼Œç¡®ä¿æŒ‰é’®åœ¨å®¹å™¨å†…æ­£å¸¸å¸ƒå±€ */
      #theme-toggle,
      #stats-toggle {
        position: relative !important;
        top: auto !important;
        right: auto !important;
        z-index: 61 !important;
      }

      /* ç§»åŠ¨ç«¯è°ƒæ•´ */
      @media (max-width: 640px) {
        .top-buttons {
          top: 8px;
          right: 8px;
          gap: 6px;
        }
        .top-button {
          font-size: 12px;
          padding: 4px 8px;
        }
      }

      /* ç»Ÿè®¡å¼¹çª—æ ·å¼ */
      #stats-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition:
          opacity 0.3s ease,
          visibility 0.3s ease;
      }
      #stats-modal.show {
        opacity: 1;
        visibility: visible;
      }
      #stats-modal .modal-content {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 20px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
        transform: translateY(-20px);
        transition: transform 0.3s ease;
        margin: 20px; /* åœ¨å°å±å¹•ä¸Šæ·»åŠ è¾¹è· */
      }
      #stats-modal.show .modal-content {
        transform: translateY(0);
      }
      #stats-modal .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid var(--border);
      }
      #stats-modal .modal-header h2 {
        margin: 0;
        color: var(--text-color);
        font-size: 18px;
      }
      #stats-modal .close-btn {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-color);
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #stats-modal .stats-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }
      #stats-modal .stat-item {
        background: color-mix(in srgb, var(--card-bg) 95%, black 5%);
        padding: 15px;
        border-radius: 6px;
        text-align: center;
        border: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 60px;
      }
      #stats-modal .stat-label {
        font-size: 14px;
        color: var(--muted);
        font-weight: 500;
        line-height: 1.2;
      }
      #stats-modal .stat-value {
        font-size: 18px;
        font-weight: bold;
        line-height: 1.2;
        color: #007acc; /* äº®è‰²ä¸»é¢˜ä¸‹çš„é«˜äº®è“è‰² */
      }

      /* æš—è‰²ä¸»é¢˜ä¸‹çš„æ•°å­—é¢œè‰² */
      html[data-theme="dark"] #stats-modal .stat-value {
        color: #4da6ff; /* æš—è‰²ä¸»é¢˜ä¸‹çš„æµ…è“è‰² */
      }
      #stats-modal .loading {
        text-align: center;
        color: var(--muted);
        padding: 40px;
      }
      #stats-modal .error {
        text-align: center;
        color: #e74c3c;
        padding: 40px;
      }
      #stats-modal .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }
      #stats-modal .stat-section {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 16px;
      }
      #stats-modal .stat-section h3 {
        margin: 0 0 12px 0;
        font-size: 14px;
        font-weight: 600;
        color: var(--text-color);
        border-bottom: 1px solid var(--border);
        padding-bottom: 8px;
      }

      /* ç§»åŠ¨ç«¯å“åº”å¼ */
      @media (max-width: 640px) {
        #stats-modal .modal-content {
          width: calc(100% - 40px);
          margin: 20px;
          padding: 15px;
          max-height: 90vh;
        }
        #stats-modal .stats-grid {
          grid-template-columns: 1fr;
          gap: 15px;
        }
        #stats-modal .stat-section {
          padding: 12px;
        }
        #stats-modal .stat-section h3 {
          font-size: 13px;
          margin-bottom: 10px;
        }
        #stats-modal .stat-item {
          padding: 12px;
          min-height: 50px;
        }
        #stats-modal .stat-label {
          font-size: 13px;
        }
        #stats-modal .stat-value {
          font-size: 16px;
        }
        #stats-modal .modal-header h2 {
          font-size: 16px;
        }
      }
    </style>
    <script type="module" src={clientScript}></script>
    <script lang="js">
      (function () {
        const btn = document.getElementById("theme-toggle");
        const titleText = document.querySelector(".topbar .title span");
        const ghLink = document.querySelector(".topbar a.github-link");

        // åˆå§‹åŒ–å¹¶ç»´æŠ¤ document.dataset.themeï¼Œè®© CSS ä½¿ç”¨å˜é‡åˆ‡æ¢é¢œè‰²
        const mq =
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)");
        let isDark = mq
          ? mq.matches
          : document.documentElement.dataset.theme === "dark";
        // åˆå§‹åŒ– datasetï¼Œä»¥ä¾¿ CSS å˜é‡ï¼ˆhtml[data-theme]) ç”Ÿæ•ˆ
        document.documentElement.dataset.theme = isDark ? "dark" : "light";

        // ç‚¹å‡»åˆ‡æ¢æŒ‰é’®æ—¶åŒæ—¶æ›´æ–° document.dataset.theme
        if (btn) {
          btn.addEventListener("click", () => {
            isDark = !isDark;
            document.documentElement.dataset.theme = isDark ? "dark" : "light";
          });
        }

        // ç›‘å¬ç³»ç»Ÿä¸»é¢˜æ”¹å˜å¹¶åŒæ­¥
        if (mq && mq.addEventListener) {
          mq.addEventListener("change", (e) => {
            isDark = e.matches;
            document.documentElement.dataset.theme = isDark ? "dark" : "light";
          });
        }

        // ç»Ÿè®¡å¼¹çª—åŠŸèƒ½
        const statsBtn = document.getElementById("stats-toggle");
        const statsModal = document.getElementById("stats-modal");
        const statsContent = document.getElementById("stats-content");
        const closeBtn = statsModal?.querySelector(".close-btn");

        function showStatsModal() {
          if (!statsModal) return;
          statsModal.classList.add("show");
          loadStatsData();
        }

        function hideStatsModal() {
          if (!statsModal) return;
          statsModal.classList.remove("show");
        }

        function loadStatsData() {
          if (!statsContent) return;

          statsContent.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';

          fetch("/stats.json")
            .then((response) => {
              if (!response.ok) {
                throw new Error("ç½‘ç»œè¯·æ±‚å¤±è´¥");
              }
              return response.json();
            })
            .then((data) => {
              renderStats(data);
            })
            .catch((error) => {
              console.error("åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:", error);
              statsContent.innerHTML =
                '<div class="error">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>';
            });
        }

        function renderStats(data) {
          if (!statsContent) return;

          const statsHtml = `
            <div class="stats-grid">
              <div class="stat-section">
                <h3>æ ¸å¿ƒèŠ‚ç‚¹</h3>
                <div class="stat-item">
                  <span class="stat-label">æ ¸å¿ƒèŠ‚ç‚¹æ•°</span>
                  <span class="stat-value">${data.coreNodes.count}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">å”¯ä¸€åŸŸå</span>
                  <span class="stat-value">${data.coreNodes.uniqueHosts}</span>
                </div>
              </div>

              <div class="stat-section">
                <h3>å‹é“¾èŠ‚ç‚¹</h3>
                <div class="stat-item">
                  <span class="stat-label">å‹é“¾èŠ‚ç‚¹æ€»æ•°</span>
                  <span class="stat-value">${data.friendNodes.total}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">å¤–éƒ¨å‹é“¾</span>
                  <span class="stat-value">${data.friendNodes.externalFriends}</span>
                </div>
              </div>

              <div class="stat-section">
                <h3>æ ¸å¿ƒèŠ‚ç‚¹é—´è¿æ¥</h3>
                <div class="stat-item">
                  <span class="stat-label">è¿æ¥æ€»æ•°</span>
                  <span class="stat-value">${data.connections.coreToCore.total}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">åŒå‘è¿æ¥</span>
                  <span class="stat-value">${data.connections.coreToCore.bidirectional}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">å•å‘è¿æ¥</span>
                  <span class="stat-value">${data.connections.coreToCore.unidirectional}</span>
                </div>
              </div>

              <div class="stat-section">
                <h3>æ ¸å¿ƒèŠ‚ç‚¹åˆ°å‹é“¾</h3>
                <div class="stat-item">
                  <span class="stat-label">è¿æ¥æ•°é‡</span>
                  <span class="stat-value">${data.connections.coreToFriend}</span>
                </div>
              </div>

              <div class="stat-section">
                <h3>æ€»è§ˆ</h3>
                <div class="stat-item">
                  <span class="stat-label">æ‰€æœ‰èŠ‚ç‚¹æ•°</span>
                  <span class="stat-value">${data.overview.totalNodes}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">æ€»è¿æ¥æ•°</span>
                  <span class="stat-value">${data.overview.totalConnections}</span>
                </div>
              </div>
            </div>
          `;

          statsContent.innerHTML = statsHtml;
        }

        if (statsBtn) {
          statsBtn.addEventListener("click", showStatsModal);
        }

        if (closeBtn) {
          closeBtn.addEventListener("click", hideStatsModal);
        }

        if (statsModal) {
          statsModal.addEventListener("click", (e) => {
            if (e.target === statsModal) {
              hideStatsModal();
            }
          });
        }

        // About modal
        const aboutBtn = document.getElementById("about-toggle");
        const aboutModal = document.getElementById("about-modal");
        const aboutClose = aboutModal?.querySelector(".close-btn");

        function showAboutModal() {
          if (!aboutModal) return;
          aboutModal.classList.add("show");
        }

        function hideAboutModal() {
          if (!aboutModal) return;
          aboutModal.classList.remove("show");
        }

        if (aboutBtn) {
          aboutBtn.addEventListener("click", showAboutModal);
        }

        if (aboutClose) {
          aboutClose.addEventListener("click", hideAboutModal);
        }

        if (aboutModal) {
          aboutModal.addEventListener("click", (e) => {
            if (e.target === aboutModal) {
              hideAboutModal();
            }
          });
        }

        // ESCé”®å…³é—­å¼¹çª—ï¼ˆå…³é—­ä»»ä¸€æ˜¾ç¤ºçš„å¼¹çª—ï¼‰
        document.addEventListener("keydown", (e) => {
          if (e.key !== "Escape") return;
          if (statsModal?.classList.contains("show")) hideStatsModal();
          if (aboutModal?.classList.contains("show")) hideAboutModal();
        });
      })();
    </script>
  </body>
</html>
